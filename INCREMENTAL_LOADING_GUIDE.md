# ğŸ”„ æ–¹æ¡ˆ 3ï¼šåˆ†æ‰¹åŠ è½½è®­ç»ƒæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

**æ··åˆæ¨¡å¼**ï¼šå°†åŸæœ¬ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®æ”¹ä¸º**åˆ†æ‰¹åŠ è½½**ï¼Œæ˜¾è‘—é™ä½å†…å­˜å ç”¨ã€‚

### æ ¸å¿ƒæ”¹è¿›

- âœ… **å†…å­˜å ç”¨é™ä½ 80%+**ï¼ˆ50GB+ â†’ ~10GBï¼‰
- âœ… **ä»£ç æ”¹åŠ¨æœ€å°**ï¼ˆ~50è¡Œï¼‰
- âœ… **ä¿ç•™æ‰€æœ‰ç°æœ‰é€»è¾‘**
- âœ… **ç«‹å³å¯ç”¨ï¼Œæ— é£é™©**

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1ï¼šä½¿ç”¨æ–° Notebookï¼ˆæ¨èï¼‰

```bash
# ç›´æ¥è¿è¡Œæ–°çš„ notebook
jupyter notebook train_model_incremental.ipynb
```

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨æ”¹é€ ç°æœ‰ä»£ç 

å‚è€ƒä¸‹é¢çš„å®ç°åŸç†ã€‚

---

## ğŸ’¡ å®ç°åŸç†

### åŸæ¥çš„æ–¹å¼ï¼ˆä¸€æ¬¡æ€§åŠ è½½ï¼‰

```python
# âŒ ä¸€æ¬¡æ€§åŠ è½½ 7 å¤©æ•°æ®ï¼ˆå†…å­˜å ç”¨ 50GB+ï¼‰
data_loader.load_data()
trainX, trainY, trainXTE, trainYTE = data_loader.get_train_data()

for epoch in range(max_epoch):
    # è®­ç»ƒæ‰€æœ‰æ•°æ®
    for batch in batches:
        train(batch)
```

### æ–°æ–¹å¼ï¼ˆåˆ†æ‰¹åŠ è½½ï¼‰

```python
# âœ… æ¯æ¬¡åªåŠ è½½ 2 å¤©æ•°æ®ï¼ˆå†…å­˜å ç”¨ ~10GBï¼‰
date_batches = [
    ('20250919', '20250920'),  # æ‰¹æ¬¡ 1
    ('20250921', '20250922'),  # æ‰¹æ¬¡ 2
    ('20250923', '20250924'),  # æ‰¹æ¬¡ 3
    ('20250925', '20250925'),  # æ‰¹æ¬¡ 4
]

for epoch in range(max_epoch):
    for batch_start, batch_end in date_batches:
        # ğŸ”‘ åªåŠ è½½å½“å‰æ‰¹æ¬¡
        data_loader.load_data_for_date_range(batch_start, batch_end)
        trainX, trainY, trainXTE, trainYTE = data_loader.get_train_data()
        
        # è®­ç»ƒå½“å‰æ‰¹æ¬¡
        train_current_batch(trainX, trainY, ...)
        
        # ğŸ—‘ï¸ é‡Šæ”¾å†…å­˜
        data_loader.clear_data()
        torch.cuda.empty_cache()
```

---

## ğŸ› ï¸ æ–°å¢ API

### 1. `load_data_for_date_range(start_date, end_date)`

ä¸ºæŒ‡å®šæ—¥æœŸèŒƒå›´åŠ è½½æ•°æ®

```python
# åªåŠ è½½ 2025-09-19 ~ 2025-09-20 çš„æ•°æ®
data_loader.load_data_for_date_range('20250919', '20250920')
trainX, trainY, trainXTE, trainYTE = data_loader.get_train_data()
```

**ç‰¹ç‚¹**ï¼š
- âœ… å¯å¤šæ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡åŠ è½½ä¸åŒæ—¥æœŸ
- âœ… é¦–æ¬¡è°ƒç”¨ä¼šåˆå§‹åŒ–èŠ‚ç‚¹åˆ—è¡¨å’Œä½ç½®ä¿¡æ¯
- âœ… ä¿æŒå½’ä¸€åŒ–å‚æ•°ä¸€è‡´ï¼ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ï¼‰

### 2. `clear_data()`

æ¸…ç©ºå·²åŠ è½½çš„æ•°æ®ï¼Œé‡Šæ”¾å†…å­˜

```python
data_loader.clear_data()  # é‡Šæ”¾æ‰€æœ‰è®­ç»ƒ/éªŒè¯/æµ‹è¯•æ•°æ®
torch.cuda.empty_cache()  # æ¸…ç† GPU ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | åŸæ¥ï¼ˆä¸€æ¬¡æ€§åŠ è½½ï¼‰ | æ–¹æ¡ˆ 3ï¼ˆåˆ†æ‰¹åŠ è½½ï¼‰ | æ”¹å–„ |
|------|-------------------|-------------------|------|
| **å†…å­˜å ç”¨** | 50GB+ | ~10GB | **â†“ 80%** |
| **æ•°æ®åŠ è½½æ—¶é—´** | 50-95 åˆ†é’Ÿï¼ˆä¸€æ¬¡ï¼‰ | 10-20 åˆ†é’Ÿï¼ˆæ¯æ‰¹ï¼‰ | æ€»æ—¶é—´ç•¥å¢ |
| **è®­ç»ƒé€Ÿåº¦** | å¿« | ç¨æ…¢ï¼ˆé¢‘ç¹åŠ è½½ï¼‰ | -10% ~ -20% |
| **ä»£ç æ”¹åŠ¨** | - | ~50 è¡Œ | æœ€å° |
| **é£é™©** | OOM å´©æºƒ | ç¨³å®šå¯æ§ | âœ… |

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨ï¼ˆæ–¹æ¡ˆ 3ï¼‰

- å†…å­˜ä¸è¶³ï¼ˆ< 64GBï¼‰
- æ•°æ®é‡å¤§ï¼ˆæ•°äº¿æ¡è®°å½•ï¼‰
- éœ€è¦å¿«é€ŸéªŒè¯
- ä¸æƒ³å¤§å¹…ä¿®æ”¹ä»£ç 

### âš ï¸ ä¸æ¨è

- å†…å­˜å……è¶³ï¼ˆ> 128GBï¼‰
- æ•°æ®é‡å°ï¼ˆ< 1000ä¸‡æ¡ï¼‰
- è¿½æ±‚æè‡´è®­ç»ƒé€Ÿåº¦

---

## ğŸ“ é…ç½®å‚æ•°

åœ¨ `train_model_incremental.ipynb` ä¸­è°ƒæ•´ï¼š

```python
args = {
    # ...å…¶ä»–é…ç½®
    
    # ğŸ†• åˆ†æ‰¹åŠ è½½é…ç½®
    'days_per_batch': 2,  # æ¯æ¬¡åŠ è½½å‡ å¤©æ•°æ®
}
```

**å»ºè®®å€¼**ï¼š
- å†…å­˜ 16GBï¼š`days_per_batch = 1`
- å†…å­˜ 32GBï¼š`days_per_batch = 2`
- å†…å­˜ 64GBï¼š`days_per_batch = 3-4`

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šå†…å­˜ä»ç„¶ä¸è¶³

**è§£å†³**ï¼šå‡å°‘ `days_per_batch`

```python
args['days_per_batch'] = 1  # æ¯æ¬¡åªåŠ è½½ 1 å¤©
```

### é—®é¢˜ 2ï¼šè®­ç»ƒé€Ÿåº¦å¤ªæ…¢

**è§£å†³**ï¼šå¢åŠ  `days_per_batch`

```python
args['days_per_batch'] = 3  # æ¯æ¬¡åŠ è½½ 3 å¤©
```

### é—®é¢˜ 3ï¼šéªŒè¯é›†æ•°æ®ä¸è¶³

**è§£å†³**ï¼šä½¿ç”¨æœ€åä¸€ä¸ªæ—¥æœŸæ‰¹æ¬¡ä½œä¸ºéªŒè¯é›†

```python
# ä»£ç ä¸­å·²è‡ªåŠ¨å¤„ç†
data_loader.load_data_for_date_range(date_batches[-1][0], date_batches[-1][1])
valX, valY, valXTE, valYTE = data_loader.get_val_data()
```

---

## ğŸš¦ ä¸‹ä¸€æ­¥å»ºè®®

### çŸ­æœŸï¼ˆç«‹å³å¯ç”¨ï¼‰
âœ… **ä½¿ç”¨æ–¹æ¡ˆ 3** - `train_model_incremental.ipynb`
- æ”¹åŠ¨æœ€å°ï¼Œé£é™©æœ€ä½
- ç«‹å³é™ä½å†…å­˜å‹åŠ›
- é€‚åˆå¿«é€ŸéªŒè¯æ¨¡å‹

### é•¿æœŸï¼ˆç”Ÿäº§çº§ï¼‰
â­ **å‡çº§åˆ°æ–¹æ¡ˆ 2** - é¢„å¤„ç† + SFT æ¨¡å¼
- è®­ç»ƒé€Ÿåº¦æœ€å¿«ï¼ˆ5-10xï¼‰
- æœ€æˆç†Ÿç¨³å®š
- é€‚åˆè§„æ¨¡åŒ–è®­ç»ƒ

### æŠ€æœ¯æ¢ç´¢ï¼ˆå¯é€‰ï¼‰
ğŸ”¬ **ç ”ç©¶æ–¹æ¡ˆ 1** - å®Œå…¨æµå¼ï¼ˆPyTorch Datasetï¼‰
- æœ€çµæ´»
- é€‚åˆç ”ç©¶å‹é¡¹ç›®
- éœ€è¦é‡æ„ä»£ç 

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´æµå¼åŠ è½½æ”¹è¿›æ€»ç»“](STREAMING_IMPROVEMENT_SUMMARY.md)
- [æµå¼åŠ è½½è¯¦ç»†æ–‡æ¡£](STREAMING_DATA_LOADING.md)
- [ä½¿ç”¨ç¤ºä¾‹](STREAMING_USAGE_EXAMPLES.md)

---

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨æ–¹æ¡ˆ 2ï¼ˆé¢„å¤„ç†ï¼‰ï¼Ÿ

A: æ–¹æ¡ˆ 2 éœ€è¦é¢å¤–å­˜å‚¨ç©ºé—´å’Œé¢„å¤„ç†æ—¶é—´ï¼Œæ–¹æ¡ˆ 3 æ˜¯å¿«é€Ÿå¯ç”¨çš„æŠ˜è¡·æ–¹æ¡ˆã€‚

### Q: æ¯ä¸ª epoch éƒ½è¦é‡æ–°åŠ è½½æ•°æ®å—ï¼Ÿ

A: æ˜¯çš„ï¼Œä½†æ¯æ‰¹æ•°æ®é‡å°ï¼ˆ2å¤©ï¼‰ï¼ŒåŠ è½½é€Ÿåº¦å¿«ï¼ˆ10-20åˆ†é’Ÿ/æ‰¹ï¼‰ã€‚

### Q: ä¼šå½±å“æ¨¡å‹æ”¶æ•›å—ï¼Ÿ

A: ä¸ä¼šã€‚æ¯ä¸ª epoch ä»ç„¶è®­ç»ƒæ‰€æœ‰æ—¥æœŸçš„æ•°æ®ï¼Œåªæ˜¯åˆ†æ‰¹åŠ è½½ã€‚

### Q: å¦‚ä½•ç›‘æ§å†…å­˜ä½¿ç”¨ï¼Ÿ

```python
import psutil
print(f"å†…å­˜ä½¿ç”¨: {psutil.virtual_memory().percent}%")
```

---

## ğŸ‰ æ€»ç»“

**æ–¹æ¡ˆ 3 æ˜¯æœ€å¿«é€Ÿã€é£é™©æœ€ä½çš„å†…å­˜ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

- âœ… æ”¹åŠ¨æœ€å°ï¼ˆ~50è¡Œï¼‰
- âœ… å†…å­˜é™ä½ 80%+
- âœ… ç«‹å³å¯ç”¨
- âœ… ä¿ç•™æ‰€æœ‰é€»è¾‘

**å¼€å§‹ä½¿ç”¨**ï¼š

```bash
jupyter notebook train_model_incremental.ipynb
```

ç¥è®­ç»ƒé¡ºåˆ©ï¼ğŸš€
